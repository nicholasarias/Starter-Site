<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nicks Site</title>

</head>

<body>
    <button onclick="submitverse()">Submit Verse</button>
    <input type="text" id="verse">
    <button onclick="getAllVerses()">Load All Verse</button>
    <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Explicabo autem iusto reprehenderit, numquam repudiandae, expedita amet vero facere ab officia similique possimus sed? Voluptate perspiciatis odit quo, eligendi explicabo iusto.</p>

    <section>
        <h2>Verse Section</h2>
        <div id="verses" style="padding:10px; margin-top:10px;">
            <!-- Verses will be displayed here -->
    </section>


    <script lang="js">
        // get Value of Text Input
        function submitverse() {
            var Uverse = document.getElementById("verse").value;
            console.log(Uverse);

            // perform fetch to server to submit verse request
            const options = {
                method: 'POST',
                headers: {
                    'verse': Uverse
                }
            };

            fetch('https://n8n.deviatedsystems.com/webhook/15e6c70d-d5f1-4ef3-8f6e-500f10f013c2', options)
                .then(response => response.json())
                .then(response => console.log(response))
                .catch(err => console.error(err));
        }
        // handle getting all verses
        let versesDiv = document.getElementById("verses");
        function displayVerses() {
            const options = {
                method: 'GET'
            };
            let verses = fetch('https://n8n.deviatedsystems.com/webhook/15e6c70d-d5f1-4ef3-8f6e-500f10f013c2', options).then(response => response.json()).then(data => {
                renderVerses(data);
            }).catch(err => console.error(err));
        }

        function renderVerses(verses) {
            versesDiv.innerHTML = ""; // Clear existing content
            verses.forEach(verse => {
                let verseElement = document.createElement("div");
                // add border to verse element
                verseElement.style.border = "1px solid black";
                verseElement.style.borderRadius = "5px";
                verseElement.style.padding = "10px";
                verseElement.style.marginBottom = "10px";



              
                
                if (verse.Favorite) {
                     verseElement.innerHTML = `<h3>${verse.Name}‚≠ê</h3><p>${verse.VerseContent}</p><hr><p><em>${verse.Ai_Explain}</em></p>`;
                }
                else {
                    verseElement.innerHTML = `<h3>${verse.Name }</h3><p>${verse.VerseContent}</p><hr><p><em>${verse.Ai_Explain}</em></p>`;
                }
              
                
                // add button to delete verse
                let deleteButton = document.createElement("button");
                deleteButton.innerHTML = "Delete";
                deleteButton.onclick = function () {
                    deleteVerse(verse.id);
                };
                // add button to favorite verse
                let favoriteButton = document.createElement("button");
                favoriteButton.innerHTML = "Favorite";
                favoriteButton.onclick = function () {
                    favoriteVerse(verse.id);
                };
                // add button to remove favorite verse
                let removeFavoriteButton = document.createElement("button");
                removeFavoriteButton.innerHTML = "Remove Favorite";
                removeFavoriteButton.onclick = function () {
                    deleteFavoriteVerse(verse.id);
                };
            


                // if is favorite, disable favorite button
                if (verse.Favorite) {
verseElement.appendChild(removeFavoriteButton);
                } else {
                    verseElement.appendChild(favoriteButton);
                }

                verseElement.appendChild(deleteButton);

                versesDiv.appendChild(verseElement);
            });
        }
        function deleteVerse(verseId) {
            const options = {
                method: 'DELETE',
                headers: {
                    'verseId': verseId
                }
            };
            fetch(`https://n8n.deviatedsystems.com/webhook/15e6c70d-d5f1-4ef3-8f6e-500f10f013c2`, options)
                .then(response => response.json())
                .then(response => {
                    console.log(response);
                    // refresh page
                    window.location.reload();
                })
                .catch(err => console.error(err));
        }

function favoriteVerse(verseId) {
            const options = {
                method: 'POST',
                headers: {
                    'verseId': verseId,
                    'favorite': true
                }
            };
            fetch(`https://n8n.deviatedsystems.com/webhook/15e6c70d-d5f1-4ef3-8f6e-500f10f013c3`, options)
                .then(response => response.json())
                .then(response => {
                    console.log(response);
                    // refresh page
                    window.location.reload();
                })
                .catch(err => console.error(err));
        }
        function deleteFavoriteVerse(verseId) {
            const options = {
                method: 'POST',
                headers: {
                    'verseId': verseId,
                    'favorite': false
                }
            };
            fetch(`https://n8n.deviatedsystems.com/webhook/15e6c70d-d5f1-4ef3-8f6e-500f10f013c3`, options)
                .then(response => response.json())
                .then(response => {
                    console.log(response);
                    // refresh page
                    window.location.reload();
                })
                .catch(err => console.error(err));
        }

        // run displayVerses when getAllVerses resolves
        displayVerses();
    </script>


</body>

</html>